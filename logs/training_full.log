================================================================================
MAPLESTORY ITEM PRICE PREDICTION - E2E PIPELINE
================================================================================

================================================================================
STEP 1: EXTRACT & TRANSFORM
================================================================================
Loading data from database...
Loaded 1204706 rows
Flattening payload_json...
Extracting time features...
Handling categorical variables...
Filling missing values...
Saved preprocessed data to data/processed/preprocessed_data.parquet

Preprocessed data shape: (1204706, 69)
Target (price) statistics:
count    1.204706e+06
mean     2.215642e+09
std      9.428379e+09
min      5.000000e+01
25%      7.777770e+05
50%      1.100000e+07
75%      1.500000e+09
max      2.000000e+12
Name: price, dtype: float64

================================================================================
STEP 2: TRAIN MODEL
================================================================================
================================================================================
TRAINING PRICE PREDICTION MODEL
================================================================================

1. Preparing features...
   Features shape: (1204706, 61)
   Target shape: (1204706,)

2. Splitting data (random sampling)...
   Note: Using random split to ensure time patterns are learned across all periods
   Time features (year, month, day_of_week, etc.) are preserved in the feature set
   Train: 843293 samples (70.0%)
   Validation: 120471 samples (10.0%)
   Test: 240942 samples (20.0%)

3. Encoding categorical features...

4. Scaling features...

5. Training model...
Training random_forest model...

6. Evaluating model...

================================================================================
MODEL PERFORMANCE METRICS
================================================================================

Train Set:
  RMSE: 1,612,755,652.11
  MAE: 191,396,178.28
  R²: 0.9699
  MAPE: 4412.47%

Validation Set:
  RMSE: 3,329,347,631.68
  MAE: 506,750,784.76
  R²: 0.8299
  MAPE: 14241.36%

Test Set:
  RMSE: 6,388,048,560.24
  MAE: 532,778,646.83
  R²: 0.6270
  MAPE: 44968.69%

7. Saving model and artifacts...
   Model saved to: models/price_prediction_model.joblib
   Scaler saved to: models/scaler.joblib
   Label encoders saved to: models/label_encoders.joblib
   Feature importance saved to: models/feature_importance.json
   Metrics saved to: models/metrics.json

================================================================================
TOP 10 MOST IMPORTANT FEATURES
================================================================================
 1. detail_PAD_max                           0.2843
 2. detail_MAD_max                           0.1010
 3. additional_grade                         0.0789
 4. payload_potential_grade                  0.0546
 5. potential_grade                          0.0544
 6. payload_trade_sn                         0.0463
 7. detail_PAD_sum                           0.0322
 8. detail_scroll_DEX_sum                    0.0251
 9. payload_item_id                          0.0248
10. item_id                                  0.0240

================================================================================
STEP 3: PIPELINE SUMMARY
================================================================================

Model Type: random_forest

Final Test Set Performance:
  RMSE: 6,388,048,560.24
  MAE: 532,778,646.83
  R²: 0.6270
  MAPE: 44968.69%

================================================================================
PIPELINE COMPLETE!
================================================================================

Model and artifacts saved in 'models/' directory
Preprocessed data saved in 'data/processed/' directory

================================================================================
STEP 4: GENERATING REPORT
================================================================================
Warning: Could not generate report: generate_report() got an unexpected keyword argument 'save_dir'
